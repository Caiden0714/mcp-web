<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ğŸ§  å°æ™º MCP æ§åˆ¶ä¸­å¿ƒ</title>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(to right, #1e3c72, #2a5298);
      color: white;
      padding: 2rem;
    }
    #log {
      height: 200px;
      background: rgba(0,0,0,0.5);
      padding: 1rem;
      overflow-y: auto;
      border-radius: 10px;
      font-family: monospace;
      margin-bottom: 1rem;
    }
    input, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    button {
      background-color: #00c9a7;
      border: none;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ğŸ§  å°æ™º MCP æ§åˆ¶ä¸­å¿ƒ</h1>
  <div>ç‹€æ…‹ï¼š<span id="status">å°šæœªé€£ç·š</span></div>
  <pre id="log"></pre>
  <input id="msg" type="text" placeholder='è¼¸å…¥ MCP æŒ‡ä»¤ï¼Œä¾‹å¦‚ {"jsonrpc":"2.0","id":1,"method":"tools/list"}' />
  <button onclick="send()">å‚³é€</button>

  <script>
    const log = document.getElementById("log");
    const status = document.getElementById("status");
    const msg = document.getElementById("msg");

    // âœ… æ›¿æ›ä¸‹åˆ—åƒæ•¸ç‚ºä½ çš„è¨­å‚™è³‡è¨Š
    const accessToken = "eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjM1Nzg4MSwiYWdlbnRJZCI6NDA2Njc3LCJlbmRwb2ludElkIjoiYWdlbnRfNDA2Njc3IiwicHVycG9zZSI6Im1jcC1lbmRwb2ludCIsImlhdCI6MTc1NDQ1NDYwN30.kRScayd1iY5c1v6lofi43V6oRRXwa-lLoGwy3ubv_kpF0oFBXCUW-_rlzlMNVxMHctx33l2TDvGarjcwHE4XTw";
    const deviceId = "30:ed:a0:bc:bb:a4";
    const clientId = "177e399a-d701-4b7e-aa69-5261c1103d4d";

    const wsUrl = `wss://api.xiaozhi.me/mcp/?token=${encodeURIComponent(accessToken)}`;
    const socket = new WebSocket(wsUrl);

    socket.onopen = () => {
      status.innerText = "å·²é€£ç·š âœ…";
      logMessage("âœ… æˆåŠŸé€£ç·šè‡³å°æ™ºä¼ºæœå™¨");
    };

    socket.onmessage = (e) => {
      logMessage("ğŸ“© æ”¶åˆ°: " + e.data);
    };

    socket.onclose = () => {
      status.innerText = "å·²æ–·ç·š âŒ";
      logMessage("âš ï¸ èˆ‡ä¼ºæœå™¨æ–·é–‹é€£ç·š");
    };

    function send() {
      if (socket.readyState === WebSocket.OPEN) {
        let payload = msg.value;
        try {
          const obj = JSON.parse(payload);
          const wrapper = {
            type: "mcp",
            payload: obj
          };
          socket.send(JSON.stringify(wrapper));
          logMessage("ğŸ“¤ ç™¼é€: " + JSON.stringify(wrapper));
        } catch (e) {
          logMessage("âŒ è«‹è¼¸å…¥æ­£ç¢ºçš„ JSON æ ¼å¼: " + e.message);
        }
        msg.value = "";
      } else {
        logMessage("âŒ ç„¡æ³•å‚³é€ï¼Œæœªé€£ç·š");
      }
    }

    function logMessage(text) {
      log.textContent += text + "\n";
      log.scrollTop = log.scrollHeight;
    }
  </script>
</body>
</html>
